<%- include("partials/footer.ejs") %>

<section
  class="container"
  style="
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 2vh;
  "
>
  <h1>ویرایش پست</h1>
  <form
    action="/edit-post/<%= post.id %>"
    method="POST"
    enctype="multipart/form-data"
    class="form"
  >
    <label>عنوان:</label>
    <input type="text" name="title" value="<%= post.title || '' %>" required />
    <div style="margin-top: 1rem">
      <p>تصویر فعلی:</p>
      <% if (post.image) { %>
      <img src="<%= post.image %>" alt="Thumbnail" style="max-width: 150px" />
      <% } else { %>
      <em>تصویری ثبت نشده است</em>
      <% } %>
    </div>

    <label>تغییر تصویر کاور:</label>
    <input type="file" name="image" accept="image/*" />

    <label>خلاصه:</label>
    <textarea name="summary" required><%= post.summary || '' %></textarea>

    <label>متن کامل:</label>
    <!-- We DON'T escape so TinyMCE gets raw HTML -->
    <textarea id="editor" name="content"><%- post.content || '' %></textarea>

    <button type="submit" style="margin-top: 1rem">ذخیره تغییرات</button>
  </form>
</section>

<script
  src="https://cdn.tiny.cloud/1/jyh7hwyj5rob6smkdrksc49veblb4xv6k5xwrzztftb0bq7e/tinymce/7/tinymce.min.js"
  referrerpolicy="origin"
></script>
<script>
  tinymce.init({
    selector: "#editor",
    directionality: "rtl",
    plugins: "lists link image code table",
    toolbar:
      "undo redo | blocks | bold italic underline | alignleft aligncenter alignright | bullist numlist | image | code",
    height: 400,
    content_style:
      "body { font-family:Vazirmatn,Arial,sans-serif; font-size:16px }",
    paste_data_images: true,
    automatic_uploads: true,
    relative_urls: false,
    images_upload_url: "/upload-image",

    image_dimensions: false, // hide width/height inputs
    image_class_list: [{ title: "Responsive", value: "img-default" }],

    // Optional: You can allow users to resize but start with default
    setup: (editor) => {
      editor.on("NodeChange", (e) => {
        if (e.element.nodeName === "IMG") {
          e.element.style.width = "500px";
          e.element.style.height = "auto";
        }
      });
    },
  });
</script>
<%- include("partials/footer.ejs") %>
